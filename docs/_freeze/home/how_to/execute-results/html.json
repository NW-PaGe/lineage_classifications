{
  "hash": "8b25be308b570ca0102aba879d02809d",
  "result": {
    "markdown": "---\ntitle: \"How to create this website\"\ndescription: Create a quarto website that connects to your github repository\ndate: September 1, 2023\ndate-modified: today\nauthor: \n  - name: Frank Aragona\n    email: frank.aragona@doh.wa.gov\n    affiliations:\n      - Washington Department of Health\n      - Data Integration/Quality Assurance\nformat: \n  html:\n    code-fold: show\n    code-overflow: wrap\n    toc: true\n    number-sections: true\n    # title-block-banner: true\n    theme:\n      dark: superhero\n      light: flaty \nexecute: \n  freeze: true\n---\n\n# Introduction\n\n![](images/DOH_logo_primary.jpg){style=\"float: right;\" fig-alt=\"Hex logo that says \\\"Data Science in a Box\\\"\" fig-align=\"right\" width=\"250\"}\n\nThis site uses a [Github Action](https://github.com/features/actions) to automatically render when a commit is pushed to the main branch of this repository.\n\nGithub Actions uses a `.yml` file in the repository to trigger an action based on a certain event. In this case, when a commit is pushed to the main branch the `.yml` will trigger this Quarto website to render to the `gh-pages` branch of the repository and publish the github page. This section will give details on how to\n\n1.  Create the website\n2.  Create, edit, and troubleshoot the Github Action to render the site\n\n# Create a Quarto Website\n\nGo to: `File > New Projectâ€¦ > New Directory > Quarto Website > Create Project`\n\nThere is an option to use `renv` which is a virtual environment for the R project. This is helpful, but if you're unfamiliar with `renv` you can un-check it.\n\n![](images/create_quarto.gif)\n\n<br>\n\nThe Quarto project will come with a `_quarto.yml` file. This is similar to an rmarkdown `yml` header where you can specify how you want your document to be style and what format to output it to.\n\n# Create a Github Action\n\nGithub Actions allow you to automate tasks in your repository. Quarto has functions for Github Actions that allow you to automatically render your Quarto document and publish it to Github Pages. [Github Pages](https://pages.github.com/) is a free service from Github to host a website. Documentation for R and Python code is usually found in a Github Page within the package repository\n\nTo create this process, I followed the [Quarto dev documentation](https://github.com/quarto-dev/quarto-actions/blob/main/examples/example-01-basics.md#quarto-actions-basics):\n\n> Add the GitHub Actions workflow to your project\n>\n> 1.  Copy [quarto-publish-example.yml](https://github.com/quarto-dev/quarto-actions/blob/main/examples/quarto-publish-example.yml) to `.github/workflows/quarto-publish.yml`. Uncomment the \"Publish to GitHub Pages (and render)\" action. No further changes are needed to the action (in particular, do not edit the line below to add a secret to this file. This file has the same permissions as your repository, and might be publicly readable)\n>\n> 2.  run `quarto publish gh-pages` locally, once\n>\n> 3.  Quarto needs to configure the repository for publishing through GitHub Actions. To do this, run `quarto publish gh-pages` locally once.\n>\n> 4.  Now, add and commit the workflow file you have just created, and push the result to GitHub. This should trigger a new action from GitHub that will automatically render and publish your website through GitHub pages.\n>\n> Note that GitHub Pages uses a gh-pages branch in your repository, which will be automatically created if one doesn't exist.\n\n<br>\n\n## Example `YAML` Workflow\n\nThe `.yml` workflow for this project looks something like this:\n\n`on:` is a tag indicating when the action will run. Right now it will run when any code gets pushed to the main branch in the documentation folder or `lineages_public_repo.R` script\n\n\n```{yaml}\n#| eval: false\n#| echo: true\non: \n  push:\n    branches:\n      - main\n    paths:\n      - documentation/**\n      - lineages_public_repo.R\n```\n\n\n`jobs:` is a tag that tells a Github virtual machine what to run and what operating system to run it on. In this case `ubuntu` with the `latest` version. This can be `windows`, `linux` or `macOS`.\n\n\n```{yaml}\n#| eval: false\n#| echo: true\nname: Render and Publish\n\njobs:\n  build-deploy:\n    runs-on: ubuntu-latest\n```\n\n\n<br>\n\nNow we have the steps:\n\n-   `env` will find the renv folder\n-   `uses: actions/checkout@v3` will refresh the repo and pull the latest changes\n-   `uses: quarto-dev/quarto-actions/setup@v2` will install quarto\n-   `uses: actions/cache@v1` and the code below it will set up `renv` and use the cached packages to install them onto the Github virtual machine\n\n\n```{yaml}\n#| eval: false\n#| echo: true\n    env:\n      RENV_PATHS_ROOT: ~/.cache/R/renv\n      \n    steps:\n      - name: Check out repository\n        uses: actions/checkout@v3\n        \n      - name: Set up Quarto\n        uses: quarto-dev/quarto-actions/setup@v2\n        \n      - name: Prep CURL install\n        run: sudo apt-get update\n\n      - name: Install CURL Headers\n        run: sudo apt-get install libcurl4-openssl-dev\n\n      # - name: Setup Renv\n      #   uses: r-lib/actions/setup-renv@v2\n  \n      - name: Cache packages\n        uses: actions/cache@v1\n        with:\n          path: ${{ env.RENV_PATHS_ROOT }}\n          key: ${{ runner.os }}-renv-${{ hashFiles('**/renv.lock') }}\n          restore-keys: |\n            ${{ runner.os }}-renv-\n      \n      - name: Restore packages\n        shell: Rscript {0}\n        run: |\n          if (!requireNamespace(\"renv\", quietly = TRUE)) install.packages(\"renv\")\n          renv::restore()\n```\n\n\n<br>\n\nAnd finally,\n\n-   `uses: quarto-dev/quarto-actions/publish@v2` will render the site by running `quarto render`\n-   `with: target: gh-pages path: documentation/_site` lets you know which branch and path to render the site to\n\n\n```{yaml}\n#| eval: false\n#| echo: true\n      - name: Publish to GitHub Pages (and render)\n        uses: quarto-dev/quarto-actions/publish@v2\n        with:\n          target: gh-pages\n          path: documentation/_site\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # this secret is always available for github actions\n\n```\n\n\n## Using `renv` in the GH Action\n\nIf you need to constantly update your website with code chunk, this is the best way to do it. It is also probably safer and better than the `_freeze` way, but it requires a better understanding of Github Actions and virtual environments.\n\n`renv` is an R package for creating a project level virtual environment. In other words, `renv` will create project specific folders that contain the specific R package versions you use in an project. [More on this here](../home/renv.qmd)\n\nTo use `renv` in a Github Action, you can put\n\n\n```{yaml}\n#| eval: false\n#| echo: true\n- name: Setup Renv\n  uses: r-lib/actions/setup-renv@v2\n```\n\n\nor use the renv cache code in the `yaml` section above\n\n## Using a `_freeze` file\n\nIf you only need to execute the code once or just need to render a non-executable code chunk once, make sure you have this code in your `_quarto.yml` file:\n\n![](images/image-1199928786.png)\n\nand then run this in your terminal window:\n\n`quarto render name-of-specific-document-or-chapter.qmd`\n\nThis will render that specific document in the website, execute code chunks if they are set to execute (`eval: true`) and then it will create a **`_freeze`** file. The `_freeze` file will save a snapshot of that specific document and *not* re-render it in the Github Action. This means you can render other parts of the website, but any files in the `_freeze` folder will stay the same as they are in the freeze. If you need to make changes to a freeze document, run the quarto render code again after making changes.\n\nThis is also documented in the [Quarto dev documentation](https://github.com/quarto-dev/quarto-actions/blob/main/examples/example-01-basics.md#quarto-actions-basics)\n\n## Troubleshooting\n\nSo you did these steps:\n\n1.  Create the `quarto-publish.yml`\n2.  Run `quarto publish gh-pages` in the **terminal**\n3.  Push all the files in your git to the main branch\n\nIf this works on your first try then the universe is taking extra special care of you.\n\nIf not, you are like the rest of us poor souls:/\n\n<br>\n\nThe first thing I would check is the error in your Github repo's Action tab.\n\n**If the error is something like `jsonlite not installed` or `some package not installed`** then it most likely means your are trying to commit a chunk of code in the documentation. *Even if you are not executing the code*, Github Actions will punish you. There are a couple options to fix this, depending on your priorities.\n\n1.  If you don't care about executing your code and/or only need to push that part of the script once, consider using the `_freeze` option\n2.  If you need to execute code *or* need to programmtically render the document with code chunks often, consider using `renv` or a similar package installation method\n\n# How to edit a chapter\n\nFirst you must clone our github repository. For more information on cloning the repo,\n\nOnce you have a local clone you can start editing these files and push updates.\n\nBasic steps:\n\n1.  Open the R Project\n2.  Open the folder/section you want to edit\n3.  Open the specific chapter in that section you want to edit (each chapter is a `.qmd` file)\n4.  Save the change and push to the main branch (or make a pull request to the main branch)\n\nOnce a commit is push to the main branch, it will trigger a Github Action to re-render the website and publish it to the main github repository\n\n## Open the R project\n\n",
    "supporting": [
      "how_to_files"
    ],
    "filters": [],
    "includes": {}
  }
}